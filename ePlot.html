<!doctype HTML>
<meta charset = 'utf-8'>
<html>
  <head>
    
    <script src='http://timelyportfolio.github.io/rCharts_errorbar/js/d3.v3.js' type='text/javascript'></script>
    <script src='http://timelyportfolio.github.io/rCharts_errorbar/js/errorbar.js' type='text/javascript'></script>
    <script src='http://timelyportfolio.github.io/rCharts_errorbar/js/d3-grid.js' type='text/javascript'></script>
    
    <style>
    .rChart {
      display: block;
      margin-left: auto; 
      margin-right: auto;
      width: 1000px;
      height: 500px;
    }  
    </style>
    
  </head>
  <body>
    
    <style>
.axis line, .axis path {
  fill: none;
  shape-rendering: crispEdges;
  stroke: lightgrey;
}
.axis text {
  fill: grey;
  font-family: "Source Sans Pro", sans-serif;
  font-size: 10px;
}
</style>

      <script>
       debugger;
      (function(){
        var opts = {
 "data": {
 "rank": [      1,      2,      3,      4,      5,      6,      7,      8,      9,     10,     11,     12,     13,     14,     15,     16,     17,     18,     19,     20,     21,     22,     23,     24,     25,     26,     27,     28,     29,     30,     31,     32,     33,     34,     35,     36,     37,     38,     39,     40,     41,     42,     43,     44,     45,     46,     47 ],
"player": [ "Aaron Rodgers", "Peyton Manning", "Drew Brees", "Matt Ryan", "Cam Newton", "Michael Vick", "Tom Brady", "Matthew Stafford", "Colin Kaepernick", "Robert Griffin III", "Andrew Luck", "Eli Manning", "Tony Romo", "Russell Wilson", "Terrelle Pryor", "Carson Palmer", "Jay Cutler", "Matt Schaub", "Josh Freeman", "Sam Bradford", "Joe Flacco", "Andy Dalton", "Philip Rivers", "Alex Smith", "Ben Roethlisberger", "Ryan Tannehill", "E.J. Manuel", "Brandon Weeden", "Chad Henne", "Christian Ponder", "Geno Smith", "Jake Locker", "Matt Flynn", "Kirk Cousins", "Nick Foles", "Mike Glennon", "Josh McCown", "Kyle Orton", "Ryan Fitzpatrick", "Jeff Tuel", "Ryan Mallett", "Charlie Whitehurst", "Matt Cassel", "Drew Stanton", "Shaun Hill", "Matt Hasselbeck", "Jason Campbell" ],
"best": [      1,      1,      1,      1,      2,      2,      1,      3,      3,      4,      2,      2,      5,      5,      5,      6,     11,      8,     11,     13,      7,     11,     12,     15,     15,     15,     12,     10,     19,     20,     20,     24,     33,     33,     33,     34,     36,     36,     37,     37,     37,     37,     38,     38,     39,     41,     42 ],
"worst": [      7,      6,      7,     15,     21,     15,     16,     18,     17,     18,     17,     20,     18,     25,     28,     26,     28,     29,     30,     29,     31,     28,     30,     30,     30,     31,     32,     32,     32,     32,     32,     32,     62,     44,     34,     48,     56,     40,     60,     59,     43,     41,     63,     46,     40,     47,     55 ],
"ave": [    1.8,    2.1,    2.7,    5.9,      7,    7.6,    7.9,    8.6,    8.9,    9.4,    9.5,   11.4,   11.7,   13.8,   16.6,   16.9,   17.9,   18.6,   19.4,   20.2,     21,   21.7,   21.8,   23.1,   23.3,   24.4,   25.3,   27.8,   27.8,   30.8,   28.6,   29.9,   38.2,   36.8,   33.3,   41.3,     46,   37.3,   48.5,     48,     40,     39,   46.7,     42,   39.5,     44,   48.5 ],
"stddev": [    1.1,      1,    1.1,    2.3,    3.4,    3.1,    3.4,      3,    2.7,      3,    3.2,    3.4,    2.4,    2.9,    4.1,    3.4,    2.9,    3.7,    3.8,    3.7,    3.6,    3.4,    3.2,    3.5,    3.3,    3.4,    3.8,      3,      3,    1.8,    2.3,    1.6,   10.7,    4.3,    0.5,    5.3,     10,    1.9,   11.5,     11,      3,      2,   11.6,      4,    0.5,      3,    6.5 ],
"category": [ "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb" ],
"ppr": [ "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N" ],
"pos": [ null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null ],
"matchup": [ null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null ] 
},
"height":    500,
"width":   1000,
"x": "player",
"y": "ave",
"color": "player" 
};
        //var margin = ,
        //  width =  - margin.left - margin.right,
        // height =  - margin.top - margin.bottom;

        var color = d3.scale.category20();

        var svg = d3.select("body").append("svg")
            .attr("width", opts.width)
            .attr("height", opts.height)

        //d3.json("fantasy.json", function (error, data) {

          if(!(opts.margin)) opts.margin = { top: 10, right: 50, bottom: 20, left: 50 }

          //data transform since rCharts does not use toJSONArray() by default
          var data = [];

          opts.data[d3.keys(opts.data)[0]].forEach(function(d,i){
            var tempobj = {};
            d3.keys(opts.data).forEach(function(key){
              tempobj[key] = opts.data[key][i];
            });
            data.push(tempobj);
          });

          //if no facet then just make blank object
          if(!(opts.facet)) opts.facet = {};
          //if facet not provided for x or y make Dummy variable
          opts.facet.x = opts.facet.x ? opts.facet.x : "Dummy"
          opts.facet.y = opts.facet.y ? opts.facet.y : "Dummy"    
          if(opts.facet.x === "Dummy" || opts.facet.y === "Dummy") {
            data.forEach(function(d){
              d.Dummy = 1;
            })
          }
          var rows = d3.set(data.map(function(d){return d[opts.facet.y]})).values();
          var nrow = rows.length;
          var cols = d3.set(data.map(function(d){return d[opts.facet.x]})).values()
          var ncol = cols.length;
  
          var tuples = d3.merge(
            rows.map(function(row,irow){
              return cols.map(function(col,icol){
                return {key:row + "~" + col, values: {"row":irow, "col":icol} }
              })
            })
          );
    
          var grid = d3.layout.grid()
            .rows( nrow )
            .cols( ncol )
            .size([ opts.width, opts.height-100])
            .bands();

          var svgGrid = d3.select("#" + opts.id).append("svg")
            .attr("width", opts.width)
            .attr("height", opts.height);
          
          grid(tuples);  //apply d3-grid layout

          tuples.forEach(function(cell,cellnum) {
            // Filter the data set for the x and y facets
            var filteredData = data.filter(function(d){
              return d[opts.facet.x] == cell.key.split('~')[1]
            });
            //split for now but could easily do all in one filter
            filteredData = filteredData.filter(function(d){
              return d[opts.facet.y] == cell.key.split('~')[0]
            });
    
            filteredData = d3.nest()
              .key(function(d){ return d[opts.facet.x] + "~" + opts.facet.y} ).sortKeys(d3.ascending)
              //.key(function(d){ return d[opts.group] } )
              .entries(filteredData);

            var errorbar = d3.svg.errorbar()
              .height(grid.nodeSize()[1]- opts.margin.top - opts.margin.bottom )
              .width(grid.nodeSize()[0] - opts.margin.right - opts.margin.left)
              .xVar(opts.x)
              .yVar(opts.y)
              .colorVar(opts.color)
              .color(color);

            var g = svg //.selectAll("g").data(filteredData);
              .append("g").data(filteredData) //g.enter().append("g")
                .attr("transform","translate(" + (+cell.x + opts.margin.right) + "," + (+cell.y+opts.margin.top) + ")")
                .call(errorbar);

          });
      })();
      </script>
    
  </body>
</html>
